

СТЕ - Common Table Expression. Создаёт временную виртуальную таблицу и позволяет использовать эту самую таблицу в самом запросе. 

Пример
```postgresql
with cte_name as (
	select column1, column2
	from table_name
	where condition
)
select * from cte_name;
```

Воспринимать форму можно так:
1) Выполняется запрос
2) Результаты кешируются
3) Выполняется основной запрос

На самом деле это не всегда так в современном Postgres. Он может делать подзапрос из блока with частью основного запроса и оптимизировать всё вместе. 
Postgres не даёт гарантий, что часть в запроса в блоке with будет выполняться отдельно от основного запроса и результат этого запроса будет как-то кешироваться.

Если мы хотим именно такого поведения, то нужно использовать материализованные CTE.

Пример
```postgresql
with cte_name as materialized (
	select column1, column2
	from table_name
	where condition
)
select * from cte_name;
```

Теперь всегда CTE материализован то мы можем гарантировать, что результат каким-то образом сохранится и мы будем использовать сохранённый результат, а не будем встраивать CTE в другой запрос (как с обычным CTE). Это очень удобно использовать в сложных запросах.