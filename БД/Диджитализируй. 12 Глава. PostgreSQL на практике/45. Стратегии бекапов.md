БД - самая важная часть проекта, её максимально не хочется потерять. Если сервер сломался и бекапов (резервных копий) нет, то всё данные будут утеряны.

**Хранить бекапы на том же сервере, что и сервер НЕЛЬЗЯ**

Какие есть стратегии бекапов:
* Логический бекап - это бекап БД в виде sql команд. Очень гибкий, но большая БД будет бекапиться и восстанавливаться долго. Зачастую можно раскатить для разных версий Postgresql. Для логического бекапа есть утилиты:
	* `pg_dump` - снять сжатый бекап - `pg_dump -U username -d database_name -j8 -Fd -f backup.dump`. Здесь параметр `-j` это количество потоков — можно ускорить снятие дампа и его разворачивание за счёт распараллеливания работы. Рекомендую пользоваться, если база данных не совсем маленькая. Можно поставить по количеству ядер на процессоре. **Часто используется на небольших БД**
	* `pg_restore` - восстановить дамп - `pg_restore -U username -d new_database_name -j8 -Fd backup.dump`.
	
* Физический бекап - стратегия с помощью `pg_basebackup`.Этот инструмент тоже идёт в комплекте с постгресом и он позволяет копировать физически всю файловую структуру базы данных. Тут уже выбрать какую-то одну табличку для бэкапирования не получится — только всё, что есть. Впрочем, оно чаще всего так и нужно, бэкапить всё, а не по частям.
	* `pg_basebackup -U username -D /backup/ -F tar -z -P`. Здесь `username` это пользователь постгреса с правами репликации, `/backup/` это директория, куда сохранится бэкап, `tar` формат файла бэкапа, флаг `-z` означает сжатие и флаг `-P` означает отображение процесса копирования.
	
* архивирование WAL-журналов - WAL это Write Ahead Log, журнал, в котором фиксируются все изменения перед их фактической записью в файлы базы данных. Из этого журнала соответственно эти изменения можно раскатывать и на другие базы данных. Когда у нас фиксируется транзакция, по сути данные гарантированно сбросились в WAL, но до файлов таблиц они могут еще и не долететь. Если данные в WAL, значит, уже всё в порядке и даже если в этот момент сервер отключится, то после включения данные из WAL до файлов таблиц долетят нормально. Делая архивирование WAL, можно постоянно бэкапить данные. То есть в случае с логической репликацией или физической репликацией мы скопировали данные на текущий момент и всё. Обновления данных мы не видим и чтобы их увидеть, надо снова всё заново копировать — ну или подтягивать как раз архивы WAL. То есть WAL это способ подтягивать обновления в базе данных в наш замечательный бэкап. Есть утилита `wal-g`, которая как раз умеет делать такие бэкапы и даже выгружать их в S3-совместимое хранилище.  [статья от Selectel](https://selectel.ru/blog/postgresql-backup-tools/) о том, как пользоваться `wal-g`. Или вот [ссылка на официальную документацию](https://github.com/wal-g/wal-g).