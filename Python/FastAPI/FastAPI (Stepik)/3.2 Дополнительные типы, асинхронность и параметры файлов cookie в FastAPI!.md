
## Дополнительные типы данных
До сих пор для аннотации типов вы использовали простые типы данных, такие как:

- `int`
- `float`
- `str`
- `bool`
- `другие стандартные типы Python'а`

Но вы также можете использовать и более сложные типы. При этом у вас останутся те же возможности , что и до сих пор. Вот некоторые из них:

- `UUID`  — 128-битное число. Его классическое текстовое представление является серией из 32 шестнадцатеричных символов, разделённых дефисами на пять групп по схеме 8-4-4-4-12.
- `datetime.datetime`
- `datetime.date`
- `datetime.time`
- `frozenset`
- `Decimal`
- `bytes`



## Асинхронные обработчики маршрутов и фоновые задачи
### Введение в асинхронные обработчики

Чтобы создать асинхронный обработчик маршрута в FastAPI, мы используем синтаксис `` `async def` ``. Асинхронный обработчик маршрута может содержать выражения `` `await` ``, указывающие точки, в которых функция может приостановить выполнение других задач, пока она ожидает завершения асинхронной операции, такой как запрос к базе данных или HTTP-запрос.

Асинхронные обработчики маршрутов особенно полезны **для обработки задач, связанных с вводом-выводом** _(I-O Bound)_, таких как выполнение сетевых запросов, чтение и запись файлов или выполнение запросов к базе данных. Вместо последовательного ожидания завершения каждой операции ввода-вывода асинхронные обработчики маршрутов могут инициировать несколько операций ввода-вывода одновременно, позволяя приложению выполнять другие задачи в ожидании завершения операций ввода-вывода.
### Фоновые задачи в FastAPI
FastAPI поддерживает фоновые задачи (задачи, которые не должны прерывать основой поток ввода-вывода, вроде отправка почты или обновление статистики).

Можно воспользоваться celery, а можно использовать решение из коробки

**Пример:**
```python
from fastapi import FastAPI, BackgroundTasks


app = FastAPI()

def write_notification(email: str, message: str):
	with open('log.txt', mode='w') as file:
		file.write(f'Пользователь {email} оставил сообщение - {message}')


@app.post('/send_notification/{email}')
async def send_notification(email: str, background_tasks: BackgroundTasks):
	background_tasks.add_task(write_notification, email, message='message')
	return {'message': 'notification sent'}
```



### Параметры Cookie
Cookie импортируется из fastapi. FastAPI поддерживает **три типа** файлов cookie:

1. Обычные файлы cookie: Это стандартные файлы cookie, которые хранятся на стороне клиента и отправляются обратно на сервер при каждом запросе. Обычные файлы cookie широко используются для различных целей, таких как управление сеансами и пользовательскими настройками.

2. Защищенные файлы cookie: Защищенные файлы cookie - это зашифрованные файлы cookie, которые обеспечивают дополнительный уровень безопасности. Под защищенными куками мы имеем ввиду куки, в которых установлен флаг `Secure`, который говорит браузеру, что эти куки можно передавать только по SSL-соединению.

3. Подписанные файлы cookie: Подписанные файлы cookie - это файлы cookie, которые содержат подпись для проверки их подлинности. Они гарантируют, что данные cookie-файлов не были изменены клиентом с тех пор, как они были установлены сервером.

**Пример** (для доступа к кукам):
```python
from fastapi import FastAPI, Cookie


app = FastAPI()


@app.get('/items/')
async def read_items(ads_id: str | None = Cookie(default=None)):
	return {'ads_id' ads_id}

@app.get('/')
async def root(last_visit = Cookie()):
	return {'last_visit': last_visit}
```

**Установка Куки. Пример:**
Куки устанавливаются в `fastapi.Response`

```python
from fastapi import FastAPI, Response
from datetime import datetime

app = FastApi()

@app.get('/')
async def root(response: Response):
	now = datetime.now().strftime("%d/%m/%Y, %H:%M:%S")
	response.set_cookie(key='last_visit', value=now)

	return {'message': 'куки установлены'}
	
```
Или при возврате значения
```python
from fastapi import FastAPI
from fastapi.responses import JSONResponse


@app.get('/')
async def root():
	now = datetime.now().strftime("%d/%m/%Y, %H:%M:%S")
	response = JSONResponse({'message': 'куки установлены'})
	response.set_cookie(key='last visit', value=now)
```

- Также можно указаьб **время** истечения срока действия файла cookie, используя параметр `"expires"`, или установить максимальный возраст, используя параметр `"max_age"`. Это помогает контролировать срок службы файлов cookie и эффективно управлять данными сеанса.
- FastAPI предоставляет **простой способ удалить** файлы cookie, установив время их истечения в прошлом. Это дает указание клиенту удалить файл cookie из своего хранилища.

> Также у класса `Response` есть метод `delete_cookie`, который принимает в качестве аргумента строку (наименование куки) и удаляет ее на стороне клиента.
> 
> Для примера:
> 
> ```
> @router.post("/logout", status_code=204)
> async def logout_user(response: Response):
>     response.delete_cookie("example_access_token")
> ```
> 
> Под капотом, этот метод вызывает метод `set_cookie` и устанавливает атрибутам `max_age` и `expires` значение 0.