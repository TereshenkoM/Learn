

## Заголовки запросов

HTTP-заголовки - это метаданные, которые сопровождают HTTP-запрос или ответ. FastAPI позволяет вам получать доступ к заголовкам запросов и работать с ними для извлечения важной информации, такой как **токены аутентификации**, **юзер-агенты** и **типы контента**.

FastAPI позволяет вам получать доступ к заголовкам запросов (headers) в рамках ваших функций маршрутизации. Вы можете использовать заголовки для предоставления дополнительной информации или данных авторизации вашему API.

```python
from typing import Annotated

from fastapi import FastAPI, Header

app = FastAPI()


@app.get("/items/")
async def read_items(user_agent: Annotated[str | None, Header()] = None):
    return {"User-Agent": user_agent}
```

Разберём эту строчку: `user_agent: Annotated[str | None, Header()] = None`:

- `user_agent` - это имя заголовка, который мы ищем;
- при помощи `Annotated` мы задаём тип данных в заголовке (строка или None), соответственно другие типы не пройдут валидацию; 
- также мы аннотируем формат тем, что указываем, что ожидаем именно заголовок (при помощи нашего класса `Header`) - то есть с помощью Annotated можно аннотировать переменную чем-то другим, кроме ее типа (например, строкой документации, чтобы какой-то гипотетический инструмент мог использовать ее для автоматического создания документации) или в нашем случае - классом, то есть мы говорим что тип - это строка или None, с одной стороны, но и заголовок - с другой;
- в дополнение класс Header переводит наш `snake_case` у `user_agent` к формату заголовков ("User-Agent") - искать будет именно его;
- и последнее - мы задаём значение заголовка по-умолчанию (`=None` ), и если заголовок не поступит в запросе, то внутри функции переменная `user_agent` будет равна None...мы можем задать здесь любое другое значение по умолчанию, если захотим.

	**Примечание**
		Заголовки также можно получить, если добавить в качестве аргумента функции объект запроса `fastapi.requests.Request`
		Пример:
	```python
	from fastapi import FastAPI
	from fastapi.requests import Request

	@app.get('/;)
	async def root(request: Request):
		user_agent = reqiest.headers.get('user-agent')
		return {'User-Agent': user_agent}
```

## Автоматическое преобразование
Класс заголовок (`Header`) обладает небольшой дополнительной функциональностью в дополнение к тому, что предоставляют `Path`, `Query` и `Cookie`.

Большинство стандартных заголовков разделены символом "дефис", также известным как "символ минуса" (-).

Но переменная, подобная `user-agent`, недопустима в Python.

Таким образом, по умолчанию `Header` преобразует символы имен параметров из символа подчеркивания (_) в дефис (-) для извлечения и документирования заголовков.

Кроме того, HTTP-заголовки не чувствительны к регистру, поэтому вы можете объявить их в стандартном стиле Python (также известном как `"snake_case"`).

Итак, вы можете использовать `user_agent`, как обычно, в коде Python, вместо того, чтобы использовать заглавные буквы как **_User_Agent_** или что-то подобное.

Если по какой-либо причине необходимо отключить автоматическое преобразование подчеркиваний в дефисы, установите параметр `convert_underscores` заголовка значение **_False._**

## Повторяющиеся заголовки

в FastAPI возможно получить повторяющиеся значения заголовка запроса, если в типе установить **list**.

**Пример**:
```python
from typing import Annotated

from fastapi import FastAPI, Header

app = FastAPI()


@app.get("/items/")
async def read_items(x_token: Annotated[list[str] | None, Header()] = None):
    return {"X-Token values": x_token}
```

Если вы взаимодействуете с этой операцией `path`, отправляя два HTTP-заголовка, таких как:

```
X-Token: foo
X-Token: bar
```

Ответ был бы таким:

```json
{
    "X-Token values": [
        "bar",
        "foo"
    ]
}
```


## Доступ к заголовкам запроса

Как было сказано ранее, заголовки запроса возможно получить:
* В `fastapi.Header`
* В `fastapi.requests.Request`

Примеры:
```python
from fastapi import FastAPI, Header
 
app = FastAPI()
 
 
@app.get("/")
def root(user_agent: str = Header()):
    return {"User-Agent": user_agent}
```

```python
from fastapi import FastAPI
from fastapi.requests import Request

app = FastAPI()


@app.get('/')
def root(request: Request):
	return {'headers': request.headers}
```


## Установка заголовков запроса

В FastAPI возможно установить свои заголовки в `fastapi.responses.Response`

Пример:
```python
from fastapi import FastAPI
from fastapi.responses import Response


app = FastApi()

@app.get('/')
def root(response: Response):
	response.headers['a'] = '123'
	return {'status': 'ok'}
```

```python
from fastapi import FastAPI
from fastapi.responses import Response


app = FastApi()

@app.get('/')
def root():
	response = Response()
	response.headers['a'] = '123'
	return {'status': 'ok'}
```